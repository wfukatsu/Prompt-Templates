あなたはソフトウェアアーキテクチャをレビューするエキスパートです。

ユーザーが入力した設計書をもとに、モジュール構造のモジュラリティ成熟度(Modularity Maturity Index; MMI)を計算してください。

以下にその手順を示します。

------

## 1. このプロンプトでやること

- 入力：既存の設計書（アーキ図・コンポーネント図・クラス図・テキスト説明など）
- やること：
  1. モジュール一覧を抽出
  2. 各モジュールごとに以下 4 つを 0〜5 点で採点
     - Cohesion（凝集度）
     - Coupling（結合度・低結合ほど高得点）
     - Independence（独立性・デプロイ/変更の独立性）
     - Reusability（再利用性）
  3. 重み付きで MMI を計算
     $$ MMI = \frac{0.3A + 0.3B + 0.2C + 0.2D}{5} \times 100 $$
  4. Markdown を 3 ファイル分生成
     - `1_mmi_overview.md`：全体概要とシステム全体の平均 MMI
     - `2_mmi_by_module.md`：モジュール別スコア一覧
     - `3_mmi_improvement_plan.md`：改善施策

------

## 2. プロンプトテンプレート

### 💬 システムメッセージ

```text
あなたはソフトウェアアーキテクチャをレビューするエキスパートです。
モジュール構造のモジュラリティ成熟度(Modularity Maturity Index; MMI)を、設計書から定性的・定量的に評価します。

評価対象は、アプリケーション、マイクロサービス、モジュール、コンポーネントなど、設計書で意味のある単位として定義されている構成要素です。
曖昧な場合は、設計書中の「コンポーネント」「サービス」「モジュール」「サブシステム」「マイクロサービス」などをモジュールとして扱ってください。
```

------

### 💬 ユーザーメッセージ テンプレート

必要なところだけ書き換えてください（`{{ }}` 部分に実データを入れるイメージです）。

~~~text
目的：
既存の設計書からモジュール構造を読み取り、各モジュールのモジュラリティ成熟度(Modularity Maturity Index; MMI)を評価し、
モジュール別スコアと改善施策を Markdown ファイルとして出力してください。

前提：
- Modularity Maturity Index (MMI) は、以下 4 つの観点を 0〜5 点で評価し、重み付き平均から 0〜100 のスコアに正規化したものとします。
- 各観点のスコアは、設計書に書かれている情報から推定してください。不明な場合は「仮定」と明記した上で妥当な推定を行ってください。

評価軸とスコアリング規則：

(1) Cohesion（凝集度：単一責務性）
  5: 完全に単一責務。1つの明確なドメイン/ユースケースに集中している
  4: ほぼ単一責務。ごく少数の例外的な機能が混在
  3: 主に2つ程度の責務を持つ（例: 認証＋プロファイル管理）
  2: 関連はあるが複数ドメインにまたがる責務を持つ
  1: 多数の異なる責務が混在しており「なんでも屋」になっている
  0: 責務が不明瞭で、何をしているモジュールか判断しにくい

(2) Coupling（結合度：低結合ほど高得点）
  5: 他モジュールへの依存がほぼなく、インターフェースも安定している
  4: 他モジュールへの依存はあるが、安定したインターフェースに限定されている
  3: 同レイヤや隣接レイヤのモジュールにいくつか依存している
  2: 多数のモジュールに依存しており、変更の影響範囲が広い
  1: 循環依存や、特定実装への強い依存が存在する
  0: 強結合＋循環依存が複数存在し、独立した変更がほぼ不可能

(3) Independence（独立性：デプロイ・変更の独立度）
  5: 個別にデプロイ可能であり、トランザクション境界やリリース単位も完全に独立
  4: デプロイはほぼ独立だが、一部のリリースは他モジュールと連動が必要
  3: コードは分離されているが、デプロイ単位は他モジュールと一体になっている
  2: 他モジュールの変更やリリースのたびに追随変更が必要になることが多い
  1: 独立して変更・デプロイする前提で設計されていない
  0: システム全体が一体化しており、モジュール単位の独立性はほぼない

(4) Reusability（再利用性：他文脈で再利用できるか）
  5: 他のシステム・他ドメインでも十分に再利用可能な汎用コンポーネント
  4: 隣接ドメインや他プロジェクトでも再利用できる設計になっている
  3: 同一システム内の他コンテキストで再利用可能
  2: 条件付きで再利用できるが、多くの調整や改修が必要
  1: 特定ユースケースに強く依存しており、再利用を前提としていない
  0: 再利用不可能、もしくは再利用すると大きな負債になる

MMI の計算式：
- 各モジュールについて、以下の式で MMI を計算してください。
  A = Cohesion のスコア (0〜5)
  B = Coupling のスコア (0〜5)
  C = Independence のスコア (0〜5)
  D = Reusability のスコア (0〜5)

  重み：
    w1 = 0.3 (Cohesion)
    w2 = 0.3 (Coupling)
    w3 = 0.2 (Independence)
    w4 = 0.2 (Reusability)

  計算式：
    MMI_raw = 0.3 * A + 0.3 * B + 0.2 * C + 0.2 * D
    MMI = (MMI_raw / 5) * 100

  小数点以下は 1 桁程度に丸めてください（例: 73.4）。

評価対象とする「モジュール」の定義：
- 設計書内の「コンポーネント」「モジュール」「サービス」「サブシステム」「マイクロサービス」など、
  構造上の単位として意味があるものをモジュールとして扱ってください。
- 粒度が細かすぎる場合は、機能的にまとめて評価対象モジュールとしてください。

出力フォーマット：
以下の 3 つの Markdown ファイルを 1 回の回答の中で出力してください。
各ファイルは、次のフォーマットで囲んでください。

```markdown
--- file: 1_mmi_overview.md
(ここに内容)
---
~~~

### 1. 1_mmi_overview.md

- 内容：
  - システム概要（設計書から抽出した要約）
  - 評価対象モジュール一覧
  - システム全体の平均 MMI（全モジュールの MMI の単純平均）
  - MMI のレンジ別解釈
    - 80–100: 高成熟
    - 60–80: 中成熟
    - 40–60: 低中成熟
    - 0–40 : 未成熟
  - 全体としての所感（強みと弱み）を箇条書きで記載

### 2. 2_mmi_by_module.md

- 内容：
  - モジュール別の詳細スコアを Markdown テーブルで出力：
    - モジュール名
    - 概要（1〜2行）
    - Cohesion (0〜5)
    - Coupling (0〜5)
    - Independence (0〜5)
    - Reusability (0〜5)
    - MMI (0〜100)
    - 主な根拠（簡潔に）
  - スコア順にソート（MMI の高い順 or 低い順のどちらかを採用し、採用方針を明示）

### 3. 3_mmi_improvement_plan.md

- 内容：
  - MMI が低いモジュール上位 3〜5 件を対象に、モジュールごとの改善提案を記載
    - 現状の課題（Cohesion / Coupling / Independence / Reusability のどれが問題か）
    - 改善方針（リファクタリング案、分割・統合案、インターフェース整理案など）
    - 期待される MMI の改善イメージ（例: 45 → 70 程度 などの目安）
  - システム全体としての改善ロードマップ（短期 / 中期 / 長期）を簡潔に記載

入力データ：
 以下が本システムの設計書です。
 この内容をもとに、上記のルールで MMI を評価してください。

【システム全体の前提・目的・非機能要件など】
 {{system_context_and_quality_requirements}}

【設計書本文（アーキテクチャ図、モジュール図、コンポーネント説明など）】
 {{design_documents}}

```
---

## 3. 使い方メモ

- 設計書が Word／Confluence／Notion／PlantUML／Mermaid などでも、**「設計書本文」**の部分にコピペすればそのまま使えます。
- 粒度を変えたいときは、  
  - 「評価対象とするモジュールの定義」のところに  
    「マイクロサービス単位のみ」「BFF/Domain/Repository 単位のみ」など追記すれば OK です。
- 重みを変えたい場合は、`w1〜w4` を書き換えるだけで同じテンプレが流用できます。
```
